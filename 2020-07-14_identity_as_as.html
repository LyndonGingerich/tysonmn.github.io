<!DOCTYPE html><html><head><title>Identity as As</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><meta name="robots" content="index,follow"><meta name="keywords" content="software, development, functional, programming, Tyson, Williams, Suggestion, functional_programming, CSharp"><meta name="theme-color" content="#212121"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="shortcut icon" href="src/assets/favicon.ico"><link href="https://fonts.googleapis.com/css?family=Hind:400,700&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:300,400&amp;display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/icon?family=Material+Icons%7CMaterial+Icons+Outlined&amp;display=swap" rel="stylesheet"><style>
      body, input, button {
        font-family: 'Hind', sans-serif;
      }

      code, .hljs {
        font-family: 'Source Code Pro', 'Courier New', Courier, monospace;
      }

      .icon-font {
        font-family: 'Material Icons';
        font-weight: normal;
        font-style: normal;
        font-size: 24px;  /* Preferred icon size */
        display: inline-block;
        line-height: 1;
        text-transform: none;
        letter-spacing: normal;
        word-wrap: normal;
        white-space: nowrap;
        direction: ltr;
      
        /* Support for all WebKit browsers. */
        -webkit-font-smoothing: antialiased;
        /* Support for Safari and Chrome. */
        text-rendering: optimizeLegibility;
      
        /* Support for Firefox. */
        -moz-osx-font-smoothing: grayscale;
      
        /* Support for IE. */
        font-feature-settings: 'liga';
      }

      .icon-font.outline {
        font-family: 'Material Icons Outlined';
      }
    </style><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-176781099-1"></script><script>(function(){function gtag(){dataLayer.push(arguments);}function sendPageViewToGoogle(){gtag('js', new Date());gtag('config', 'UA-176781099-1', { 'page_path': location.pathname });}window.dataLayer = window.dataLayer || [];window.addEventListener("navigation", sendPageViewToGoogle);sendPageViewToGoogle();})();</script><link href="/styles/codedoc-styles.css" rel="stylesheet"><script async="" defer="" src="/bundle/codedoc-bundle.js"></script><style>.container{padding-top: 0 !important}</style><style>#-codedoc-toc { backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px) }</style><meta name="twitter:title" content="Identity as As"><meta property="og:type" content="article"><meta property="og:title" content="Identity as As"><meta property="blog-tags" content="Suggestion, functional_programming, CSharp"></head><body><div class="header-0-0-11"></div><div id="-codedoc-container" class="container"><script>window.source = {"base":"src/markdown","path":"2020-07-14_identity_as_as.md","namespace":"","title":{"base":"","connector":" | "}}</script><div class="hero-0-0-1"><img src="src/assets/images/as_extension_method.png" class="image-0-0-2" data-hero=""><span class="caption-0-0-3"></span></div><h1 class="h-0-0-4 "><span style=" 
      text-shadow: none; 
      font-size: 48px"><p>Identity as As</p></span></h1><script id="fenlqnxYwM">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("fenlqnxYwM", "yXTA2r/5r/GpeOWZVIF4LQ==", {"name":"Tyson Williams","date":"2020-07-14","avatar":"src/assets/images/TysonWilliams.jpg"});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); window.setImmediate = window.setImmediate || function(f){setTimeout(f, 0)}; })()</script><p><em>The identity function is a useful extension method in C#.</em></p><p>The <a href="https://en.wikipedia.org/wiki/Identity_function">identity function</a> is so trivial.  And yet, it is important enough that both <a href="https://baronfel.github.io/fsharp-core-api-docs//reference/FSharp.Core/microsoft-fsharp-core-operators.html#body-inner:~:text=The%20identity%20function">F#</a> and <a href="https://hackage.haskell.org/package/base-4.14.0.0/docs/Prelude.html#v:id">Haskell</a> expose this function to all developers under the name <code>id</code>.  The <a href="https://stackoverflow.com/questions/44545396/whats-the-purpose-of-id-function-in-the-fsharp-core/44545932#44545932">standard justification</a> is that <code>id</code> can be a useful argument to a <a href="https://en.wikipedia.org/wiki/Higher-order_function">higher-order function</a>.  This is certainly true, but it is not the only justification.  In C#, I have found reasonable uses for calling <code>id</code> as an extension method.</p><h1 id="identity-extension-method" class="heading-0-0-5"><span class="anchor-0-0-6" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Identity extension method</h1><p>Here is how I prefer to define the identity function as an extension method.</p><pre class="with-bar"><code class="csharp -codedoc-code-snippet code-0-0-18" tabindex="0"><span class="wmbar-0-0-23"><span></span><span></span><span></span><span>GenericExtensions.cs</span></span><div class="line-0-0-22  -codedoc-code-line" data-content="public static class GenericExtensions {" id="code1-l1"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">GenericExtensions</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  public static A As<A>(this A a) => a;" id="code1-l2"><span class="lineCounter-0-0-19 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">A</span> <span class="token generic-method"><span class="token function">As</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>A<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">A</span> a<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a<span class="token punctuation">;</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="}" id="code1-l3"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">}</span></div><br></code></pre><p>My intended use case for this method is to explicitly specify the type parameter so that the C# compiler inserts an <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/conversions#implicit-conversions">implicit conversion</a> to <code>A</code> before supplying the result as the argument to this method.  This method is an explicit way to call an implicit conversion.</p><p>The name <code>As</code> is probably a surprise.  <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/conversions#implicit-conversions:~:text=The%20pre%2Ddefined%20implicit%20conversions%20always%20succeed%20and%20never%20cause%20exceptions%20to%20be%20thrown.">Pre-defined implicit conversions</a> and the <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/operators/type-testing-and-cast#as-operator:~:text=the%20as%20operator%20never%20throws%20an%20exception."><code>as</code> operator</a> are both type conversions and neither throws an exception.  If all <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/conversions#implicit-conversions:~:text=Properly%20designed%20user%2Ddefined%20implicit%20conversions%20should%20exhibit%20these%20characteristics%20as%20well.">user-defined implicit conversions are properly designed</a>, then the use of this method never causes an exception to be thrown.  In fact, it would always succeed.  I like the name <code>As</code> because of this similarity and because the resulting code reads so well.</p><h1 id="examples" class="heading-0-0-5"><span class="anchor-0-0-6" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Examples</h1><p>Here are example use cases that I have found for this extension method.  The typical alternative is to use a <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/expressions#cast-expressions">cast expression</a>.  I think using a cast expression is worse because it is a code smell (because a <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/conversions#explicit-conversions:~:text=conversions%20that%20cannot%20be%20proven%20to%20always%20succeed">cast expression can fail at runtime</a>) and because the readability of the extension method is better.</p><h2 id="1-ternary-operator" class="heading-0-0-5"><span class="anchor-0-0-6" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>1. Ternary operator</h2><p>The expressions in the branches of a ternary operator must have an <a href="https://github.com/dotnet/docs/issues/19468">implicit conversion from one type to the other</a>.  When this not the case, we can use <code>As</code> to make it so.</p><pre class=""><code class="csharp -codedoc-code-snippet code-0-0-18" tabindex="0"><span class="wmbar-0-0-23"><span></span><span></span><span></span><span></span></span><div class="line-0-0-22  -codedoc-code-line" data-content="interface IPlanet { }" id="code2-l1"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">interface</span> <span class="token class-name">IPlanet</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="class Earth : IPlanet { }" id="code2-l2"><span class="lineCounter-0-0-19 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">class</span> <span class="token class-name">Earth</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IPlanet</span></span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="class Mars : IPlanet { }" id="code2-l3"><span class="lineCounter-0-0-19 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">class</span> <span class="token class-name">Mars</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IPlanet</span></span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="class Sandbox {" id="code2-l4"><span class="lineCounter-0-0-19 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">class</span> <span class="token class-name">Sandbox</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  public IPlanet GetPlanet(bool b) =>" id="code2-l5"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">public</span> <span class="token return-type class-name">IPlanet</span> <span class="token function">GetPlanet</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> b<span class="token punctuation">)</span> <span class="token operator">=&gt;</span></div><br><div class="line-0-0-22 highlight -codedoc-code-line" data-content="    b ? new Earth() : new Mars().As<IPlanet>();" id="code2-l6"><span class="lineCounter-0-0-19 -codedoc-line-counter">6<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    b <span class="token punctuation">?</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Earth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Mars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">As</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IPlanet<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="}" id="code2-l7"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">7<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">}</span></div><br></code></pre><p>This issue looks like it <a href="https://github.com/dotnet/csharplang/issues/2460">will be fixed</a> in a future version of C#.</p><p>In the meantime, an alternative that I sometimes prefer is to replace the ternary operator with an <code>if-else</code> statement so that the compiler can infer both implicit conversions.</p><pre class=""><code class="csharp -codedoc-code-snippet code-0-0-18" tabindex="0"><span class="wmbar-0-0-23"><span></span><span></span><span></span><span></span></span><div class="line-0-0-22  -codedoc-code-line" data-content="public IPlanet GetPlanet(bool b) {" id="code3-l1"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">public</span> <span class="token return-type class-name">IPlanet</span> <span class="token function">GetPlanet</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  if (b) {" id="code3-l2"><span class="lineCounter-0-0-19 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="    return new Earth();" id="code3-l3"><span class="lineCounter-0-0-19 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Earth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  } else {" id="code3-l4"><span class="lineCounter-0-0-19 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="    return new Mars();" id="code3-l5"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Mars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  }" id="code3-l6"><span class="lineCounter-0-0-19 -codedoc-line-counter">6<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token punctuation">}</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="}" id="code3-l7"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">7<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">}</span></div><br></code></pre><h2 id="2-explicit-interface" class="heading-0-0-5"><span class="anchor-0-0-6" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>2. Explicit interface</h2><p>When a class <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/interfaces/explicit-interface-implementation">explicitly implements an interface</a>, one cannot directly call any interface method given a reference with the implementing class as its compile-time type.  It is necessary to first invoke the <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/types/casting-and-type-conversions#code-try-1:~:text=For%20reference%20types%2C%20an%20implicit%20conversion,or%20indirect%20base%20classes%20or%20interfaces.">implicit conversion that exists to an interface from an implementing class</a>.</p><pre class=""><code class="csharp -codedoc-code-snippet code-0-0-18" tabindex="0"><span class="wmbar-0-0-23"><span></span><span></span><span></span><span></span></span><div class="line-0-0-22  -codedoc-code-line" data-content="interface IPlanet {" id="code4-l1"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">interface</span> <span class="token class-name">IPlanet</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  bool HasLife { get; }" id="code4-l2"><span class="lineCounter-0-0-19 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token return-type class-name"><span class="token keyword">bool</span></span> HasLife <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="}" id="code4-l3"><span class="lineCounter-0-0-19 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">}</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="" id="code4-l4"><span class="lineCounter-0-0-19 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="class Earth : IPlanet {" id="code4-l5"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">class</span> <span class="token class-name">Earth</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IPlanet</span></span> <span class="token punctuation">{</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  bool IPlanet.HasLife => true;" id="code4-l6"><span class="lineCounter-0-0-19 -codedoc-line-counter">6<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token return-type class-name"><span class="token keyword">bool</span></span> IPlanet<span class="token punctuation">.</span>HasLife <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">;</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="}" id="code4-l7"><span class="lineCounter-0-0-19 -codedoc-line-counter">7<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">}</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="" id="code4-l8"><span class="lineCounter-0-0-19 -codedoc-line-counter">8<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="class Sandbox {" id="code4-l9"><span class="lineCounter-0-0-19 -codedoc-line-counter">9<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">class</span> <span class="token class-name">Sandbox</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  public bool EarthHasLife =>" id="code4-l10"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">10<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> EarthHasLife <span class="token operator">=&gt;</span></div><br><div class="line-0-0-22 highlight -codedoc-code-line" data-content="    new Earth().As<IPlanet>().HasLife;" id="code4-l11"><span class="lineCounter-0-0-19 -codedoc-line-counter">11<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Earth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">As</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IPlanet<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>HasLife<span class="token punctuation">;</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="}" id="code4-l12"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">12<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">}</span></div><br></code></pre><h2 id="3-hidden-member" class="heading-0-0-5"><span class="anchor-0-0-6" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>3. Hidden member</h2><p>Members can be <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/language-specification/basic-concepts#hiding-through-inheritance">hidden in an inheritance hierarchy</a>.  This case is similar to the previous case with explicit interfaces.  The difference is that removing <code>As</code> in that case causes a compiler error while removing <code>As</code> in this changes the resolved member.</p><pre class=""><code class="csharp -codedoc-code-snippet code-0-0-18" tabindex="0"><span class="wmbar-0-0-23"><span></span><span></span><span></span><span></span></span><div class="line-0-0-22  -codedoc-code-line" data-content="class Planet {" id="code5-l1"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">class</span> <span class="token class-name">Planet</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  public bool? HasLife => null;" id="code5-l2"><span class="lineCounter-0-0-19 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span><span class="token punctuation">?</span></span> HasLife <span class="token operator">=&gt;</span> <span class="token keyword">null</span><span class="token punctuation">;</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="}" id="code5-l3"><span class="lineCounter-0-0-19 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">}</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="" id="code5-l4"><span class="lineCounter-0-0-19 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="class Earth : Planet {" id="code5-l5"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">class</span> <span class="token class-name">Earth</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Planet</span></span> <span class="token punctuation">{</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  public new bool? HasLife => true;" id="code5-l6"><span class="lineCounter-0-0-19 -codedoc-line-counter">6<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">public</span> <span class="token keyword">new</span> <span class="token return-type class-name"><span class="token keyword">bool</span><span class="token punctuation">?</span></span> HasLife <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">;</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="}" id="code5-l7"><span class="lineCounter-0-0-19 -codedoc-line-counter">7<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">}</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="" id="code5-l8"><span class="lineCounter-0-0-19 -codedoc-line-counter">8<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="class Sandbox {" id="code5-l9"><span class="lineCounter-0-0-19 -codedoc-line-counter">9<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">class</span> <span class="token class-name">Sandbox</span> <span class="token punctuation">{</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  public bool? EarthAsPlanetHasLife =>" id="code5-l10"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">10<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span><span class="token punctuation">?</span></span> EarthAsPlanetHasLife <span class="token operator">=&gt;</span></div><br><div class="line-0-0-22 highlight -codedoc-code-line" data-content="    new Earth().As<Planet>().HasLife;" id="code5-l11"><span class="lineCounter-0-0-19 -codedoc-line-counter">11<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Earth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">As</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Planet<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>HasLife<span class="token punctuation">;</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="}" id="code5-l12"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">12<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">}</span></div><br></code></pre><p>Don't use hidden members though.  It makes things very confusing.</p><h2 id="4-ambiguous-call" class="heading-0-0-5"><span class="anchor-0-0-6" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>4. Ambiguous call</h2><p>I have only ever experienced this use case once, so I decided to provide that exact example instead of creating a simpler one.</p><p><a href="https://github.com/louthy/language-ext"><code>language-ext</code></a> contains extension methods for <a href="https://github.com/louthy/language-ext/blob/4db4d9277151628e35309227475738180488606d/LanguageExt.Core/Extensions/TryOutExt.cs#L36-L42">safely getting the value out of a dictionary</a> that are mostly the same.  The main difference is the type of the first argument.  One is for <a href="https://github.com/louthy/language-ext/blob/4db4d9277151628e35309227475738180488606d/LanguageExt.Core/Extensions/TryOutExt.cs#L19-L25"><code>IDictionary&lt;K, V&gt;</code></a> and the other is for <a href="https://github.com/louthy/language-ext/blob/4db4d9277151628e35309227475738180488606d/LanguageExt.Core/Extensions/TryOutExt.cs#L36-L42"><code>IReadOnlyDictionary&lt;K, V&gt;</code></a>.  Because of that, this is a compiler error.</p><pre class=""><code class="csharp -codedoc-code-snippet code-0-0-18" tabindex="0"><span class="wmbar-0-0-23"><span></span><span></span><span></span><span></span></span><div class="line-0-0-22  -codedoc-code-line" data-content="new Dictionary<int, int>()./*~err~*/TryGetValue/*~err~*/(0);" id="code6-l1"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token comment" hidden="">/*~err~*/</span><span class="error">TryGetValue<span class="wave">~~~~~~~~~~~</span></span><span class="token comment" hidden="">/*~err~*/</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br></code></pre><blockquote><p>Error CS0121 The call is ambiguous between the following methods or properties: <code>OutExtensions.TryGetValue&lt;K, V&gt;(IDictionary&lt;K, V&gt;, K)</code> and <code>OutExtensions.TryGetValue&lt;K, V&gt;(IReadOnlyDictionary&lt;K, V&gt;, K)</code></p></blockquote><p>I dislike so much about this.  (Below, I omit the type parameters for brevity.)</p><p>First, I think that <code>IReadOnlyDictionary</code> is not a good name.  It suggests that implementations must be immutable, but this is not the case.  Instead, a better name would be <code>IReadableDictionary</code>.  Better still would be to rename <code>IDictionary</code> to <code>IMutableDictionary</code> and rename <code>IReadOnlyDictionary</code> to <code>IDictionary</code> so that the safer type has the preferred name.</p><p>Second, <a href="https://github.com/dotnet/runtime/issues/31001"><code>IDictionary</code> should extend <code>IReadOnlyDictionary</code></a>.  With this change, I think the compiler would select the extension method for <code>IDictionary</code>.  In fact, <code>language-ext</code> could then remove the extension method for <code>IDictionary</code>.</p><p>Third, <code>language-ext</code> could solve this problem now by also adding this extension method for <code>Dictionary</code>.  Instead, the <a href="https://github.com/louthy/language-ext/issues/414#issuecomment-390632509">recommended workaround</a> is to name the argument, which varies accordingly for these two extension methods.</p><p>That workaround is fine, but if the argument names were also the same, then calling <code>As</code> is another workaround.</p><pre class=""><code class="csharp -codedoc-code-snippet code-0-0-18" tabindex="0"><span class="wmbar-0-0-23"><span></span><span></span><span></span><span></span></span><div class="line-0-0-22 highlight -codedoc-code-line" data-content="new Dictionary<int, int>().As<IDictionary<int, int>>().TryGetValue(0);" id="code7-l1"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">As</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IDictionary<span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br></code></pre><h2 id="5-excessive-inference" class="heading-0-0-5"><span class="anchor-0-0-6" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>5. Excessive inference</h2><p>The C# compiler can <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/generics/generic-methods#code-try-1:~:text=You%20can%20also%20omit%20the%20type%20argument%20and%20the%20compiler%20will%20infer%20it.">infer the type arguments of a method</a>.  The C# compiler can infer the need for an implicit conversion.  But the C# compiler cannot do too many of these at once.</p><p>Consider <a href="https://github.com/la-yumba/functional-csharp-code/blob/02eac68e275286e5301ab3fe1cc611540d340d21/LaYumba.Functional.Tests/Option/ApplicativeLaws.cs#L93-L95">this function</a>, which also appears on page 186 of <a href="https://www.manning.com/books/functional-programming-in-c-sharp">Functional Programming in C#</a>.  Notice the implicit conversion from <code>R</code> to <code>Option&lt;R&gt;</code> for the value <code>f(t)</code>.</p><pre class=""><code class="csharp -codedoc-code-snippet code-0-0-18" tabindex="0"><span class="wmbar-0-0-23"><span></span><span></span><span></span><span></span></span><div class="line-0-0-22  -codedoc-code-line" data-content="public Option<R> ApplyInTermsOfBind<T, R>(" id="code8-l1"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">public</span> <span class="token return-type class-name">Option<span class="token punctuation">&lt;</span>R<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">ApplyInTermsOfBind</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> R<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  Option<Func<T, R>> func," id="code8-l2"><span class="lineCounter-0-0-19 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token class-name">Option<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> R<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> func<span class="token punctuation">,</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  Option<T> arg" id="code8-l3"><span class="lineCounter-0-0-19 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token class-name">Option<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> arg</div><br><div class="line-0-0-22  -codedoc-code-line" data-content=") =>" id="code8-l4"><span class="lineCounter-0-0-19 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  arg.Bind(t => func.Bind<Func<T, R>, R>(f => f(t)));" id="code8-l5"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  arg<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> func<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Bind</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> R<span class="token punctuation">&gt;</span><span class="token punctuation">,</span> R<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>f <span class="token operator">=&gt;</span> <span class="token function">f</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br></code></pre><p>The type parameters of the inner call to <code>Bind</code> are specified because there would be a compiler error without them.</p><blockquote><p>Error CS1061 <code>Option&lt;Func&lt;T, R&gt;&gt;</code> does not contain a definition for <code>Bind</code> and no accessible extension method <code>Bind</code> accepting a first argument of type <code>Option&lt;Func&lt;T, R&gt;&gt;</code> could be found (are you missing a using directive or an assembly reference?)</p></blockquote><p>If any <em>one</em> type argument of a method cannot be inferred, then <em>all</em> type arguments must be explicitly provided.  In contrast, we only have to provide one type parameter for each call to <code>As</code>.  Therefore, I typically prefer to help the compiler by explicitly invoking an implicit conversion via <code>As</code>.  In this case, instead of specifying two type parameters to <code>Bind</code>, we only need to specify one type parameter to <code>As</code> to invoke the implicit conversion.</p><p>As least, that is what I expected.  Instead, this code doesn't compile.  I do not understand why.</p><pre class=""><code class="csharp -codedoc-code-snippet code-0-0-18" tabindex="0"><span class="wmbar-0-0-23"><span></span><span></span><span></span><span></span></span><div class="line-0-0-22  -codedoc-code-line" data-content="public Option<R> ApplyInTermsOfBind<T, R>(" id="code9-l1"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">public</span> <span class="token return-type class-name">Option<span class="token punctuation">&lt;</span>R<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">ApplyInTermsOfBind</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> R<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  Option<Func<T, R>> func," id="code9-l2"><span class="lineCounter-0-0-19 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token class-name">Option<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> R<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> func<span class="token punctuation">,</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  Option<T> arg" id="code9-l3"><span class="lineCounter-0-0-19 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token class-name">Option<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> arg</div><br><div class="line-0-0-22  -codedoc-code-line" data-content=") =>" id="code9-l4"><span class="lineCounter-0-0-19 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  arg.Bind(t => func.Bind<Func<T, R>, R>(f => /*~err~*/f(t/*~err~*/).As<Option<R>>()));" id="code9-l5"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  arg<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> func<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Bind</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> R<span class="token punctuation">&gt;</span><span class="token punctuation">,</span> R<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>f <span class="token operator">=&gt;</span> <span class="token comment" hidden="">/*~err~*/</span><span class="token function error">f<span class="wave">~</span></span><span class="token punctuation error">(<span class="wave">~</span></span><span class="error">t<span class="wave">~</span></span><span class="token comment" hidden="">/*~err~*/</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">As</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Option<span class="token punctuation">&lt;</span>R<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br></code></pre><blockquote><p>Error CS1929 <code>R</code> does not contain a definition for <code>As</code> and the best extension method overload <code>GenericExtensions.As&lt;Option&lt;R&gt;&gt;(Option&lt;R&gt;)</code> requires a receiver of type <code>Option&lt;R&gt;</code></p></blockquote><p>It does work though when <code>As</code> is called like a static method instead of an extension method.  Now we don't have to specify the type parameters to <code>Bind</code>.</p><pre class=""><code class="csharp -codedoc-code-snippet code-0-0-18" tabindex="0"><span class="wmbar-0-0-23"><span></span><span></span><span></span><span></span></span><div class="line-0-0-22  -codedoc-code-line" data-content="public Option<R> ApplyInTermsOfBind<T, R>(" id="code10-l1"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">public</span> <span class="token return-type class-name">Option<span class="token punctuation">&lt;</span>R<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">ApplyInTermsOfBind</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> R<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  Option<Func<T, R>> func," id="code10-l2"><span class="lineCounter-0-0-19 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token class-name">Option<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> R<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> func<span class="token punctuation">,</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  Option<T> arg" id="code10-l3"><span class="lineCounter-0-0-19 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token class-name">Option<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> arg</div><br><div class="line-0-0-22  -codedoc-code-line" data-content=") =>" id="code10-l4"><span class="lineCounter-0-0-19 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></div><br><div class="line-0-0-22 highlight -codedoc-code-line" data-content="  arg.Bind(t => func.Bind(f => GenericExtensions.As<Option<R>>(f(t))));" id="code10-l5"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  arg<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> func<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span>f <span class="token operator">=&gt;</span> GenericExtensions<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">As</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Option<span class="token punctuation">&lt;</span>R<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br></code></pre><p>In the end, the best implementation would be to define a function <code>Some</code> that invokes the implicit conversion from <code>R</code> to <code>Option&lt;R&gt;</code> and then use that.</p><pre class=""><code class="csharp -codedoc-code-snippet code-0-0-18" tabindex="0"><span class="wmbar-0-0-23"><span></span><span></span><span></span><span></span></span><div class="line-0-0-22  -codedoc-code-line" data-content="public Option<R> ApplyInTermsOfBind<T, R>(" id="code11-l1"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">public</span> <span class="token return-type class-name">Option<span class="token punctuation">&lt;</span>R<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">ApplyInTermsOfBind</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> R<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  Option<Func<T, R>> func," id="code11-l2"><span class="lineCounter-0-0-19 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token class-name">Option<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> R<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> func<span class="token punctuation">,</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  Option<T> arg" id="code11-l3"><span class="lineCounter-0-0-19 -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  <span class="token class-name">Option<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> arg</div><br><div class="line-0-0-22  -codedoc-code-line" data-content=") =>" id="code11-l4"><span class="lineCounter-0-0-19 -codedoc-line-counter">4<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="  arg.Bind(t => func.Bind(f => Some(f(t))));" id="code11-l5"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">5<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span>  arg<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span>t <span class="token operator">=&gt;</span> func<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span>f <span class="token operator">=&gt;</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br></code></pre><h2 id="6-type-invariance" class="heading-0-0-5"><span class="anchor-0-0-6" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>6. Type invariance</h2><p><em>Added on 2020-07-27</em></p><p><a href="https://en.wikipedia.org/wiki/Covariance_and_contravariance_(computer_science)">Type variance</a> extends the inheritance hierarchy of a generic type based on the inheritance hierarchy of its type parameters.  For example, because <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.ienumerable-1#type-parameters:~:text=This%20type%20parameter%20is%20covariant.%20That,see%20Covariance%20and%20Contravariance%20in%20Generics."><code>IEnumerable&lt;T&gt;</code> is covariant (in <code>T</code>)</a> and because <code>object</code> is a subtype of <code>string</code>, it follows that <code>IEnumerable&lt;object&gt;</code> is a subtype of <code>IEnumerable&lt;string&gt;</code>.  <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/covariance-contravariance/">Covariance in C#</a> is specified with the <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/out-generic-modifier"><code>out</code> keyword on the type parameter</a>.  For example, here it is in the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.ienumerable-1#code-try-0:~:text=public%20interface%20IEnumerable%3Cout%20T%3E%20%3A%20System.Collections.IEnumerable">definition for <code>IEnumerable&lt;T&gt;</code></a>.</p><pre class=""><code class="csharp -codedoc-code-snippet code-0-0-18" tabindex="0"><span class="wmbar-0-0-23"><span></span><span></span><span></span><span></span></span><div class="line-0-0-22  -codedoc-code-line" data-content="public interface IEnumerable<out T> : System.Collections.IEnumerable" id="code12-l1"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">out</span> T<span class="token punctuation">&gt;</span></span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>IEnumerable</span></span></div><br></code></pre><p>In contrast, consider the <a href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.tasks.task-1#code-try-0:~:text=public%20class%20Task%3CTResult%3E%20%3A%20System.Threading.Tasks.Task">definition of <code>Task&lt;TResult&gt;</code></a>.</p><pre class=""><code class="csharp -codedoc-code-snippet code-0-0-18" tabindex="0"><span class="wmbar-0-0-23"><span></span><span></span><span></span><span></span></span><div class="line-0-0-22  -codedoc-code-line" data-content="public class Task<TResult> : System.Threading.Tasks.Task" id="code13-l1"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Task<span class="token punctuation">&lt;</span>TResult<span class="token punctuation">&gt;</span></span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks<span class="token punctuation">.</span>Task</span></span></div><br></code></pre><p>It lacks the <code>out</code> keyword (and the <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/in-generic-modifier"><code>in</code> keyword</a>), as every <code>class</code> in C# must (since only interfaces and delegates support them), so <code>Task&lt;TResult&gt;</code> is invariant (in <code>TResult</code>).  As a consequence, <code>Task&lt;object&gt;</code> is not a subtype of <code>Task&lt;string&gt;</code>, so this code doesn't compile.</p><pre class=""><code class="csharp -codedoc-code-snippet code-0-0-18" tabindex="0"><span class="wmbar-0-0-23"><span></span><span></span><span></span><span></span></span><div class="line-0-0-22  -codedoc-code-line" data-content="public Task<string> taskString = Task.FromResult(&quot;&quot;);" id="code14-l1"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">public</span> <span class="token class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> taskString <span class="token operator">=</span> Task<span class="token punctuation">.</span><span class="token function">FromResult</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="public void Foo() => Bar(/*~err~*/taskString/*~err~*/);" id="code14-l2"><span class="lineCounter-0-0-19 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">Bar</span><span class="token punctuation">(</span><span class="token comment" hidden="">/*~err~*/</span><span class="error">taskString<span class="wave">~~~~~~~~~~</span></span><span class="token comment" hidden="">/*~err~*/</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="public void Bar(Task<object> _) { }" id="code14-l3"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Bar</span><span class="token punctuation">(</span><span class="token class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> _<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></div><br></code></pre><blockquote><p>Error CS1503 Argument 1: cannot convert from <code>System.Threading.Tasks.Task&lt;string&gt;</code> to <code>System.Threading.Tasks.Task&lt;object&gt;</code></p></blockquote><p>We can compensate for the lack of covariance using our identity function.</p><pre class=""><code class="csharp -codedoc-code-snippet code-0-0-18" tabindex="0"><span class="wmbar-0-0-23"><span></span><span></span><span></span><span></span></span><div class="line-0-0-22  -codedoc-code-line" data-content="public Task<string> taskString = Task.FromResult(&quot;&quot;);" id="code15-l1"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">1<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">public</span> <span class="token class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> taskString <span class="token operator">=</span> Task<span class="token punctuation">.</span><span class="token function">FromResult</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="public void Foo() => Bar(taskString.ContinueWith(x => x.As<object>()));" id="code15-l2"><span class="lineCounter-0-0-19 -codedoc-line-counter">2<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">Bar</span><span class="token punctuation">(</span>taskString<span class="token punctuation">.</span><span class="token function">ContinueWith</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">As</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div><br><div class="line-0-0-22  -codedoc-code-line" data-content="public void Bar(Task<object> _) { }" id="code15-l3"><span class="lineCounter-0-0-19 prim -codedoc-line-counter">3<span class="-codedoc-line-link"><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span></span><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Bar</span><span class="token punctuation">(</span><span class="token class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> _<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span></div><br></code></pre><p>I also encounter this situation with <a href="https://github.com/louthy/language-ext"><code>language-ext</code></a> when using invariant types like <a href="https://github.com/louthy/language-ext/blob/4db4d9277151628e35309227475738180488606d/LanguageExt.Core/DataTypes/Option/Option.cs#L36"><code>Option&lt;T&gt;</code></a>.</p><h1 id="summary" class="heading-0-0-5"><span class="anchor-0-0-6" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Summary</h1><p>The identity function is a useful extension method in C# because it can help the compiler figure out the intended types in situations that would otherwise be too complicated and cause a compiler error.</p><hr><p>The code in this post is available <a href="https://github.com/TysonMN/tyson-williams-blog/tree/master/src/code/IdentityAsAs">here</a>.</p><script id="eggWARRvnY">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("eggWARRvnY", "MMjgklS7jpZfoV5c1cMBAg==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); window.setImmediate = window.setImmediate || function(f){setTimeout(f, 0)}; })()</script><h1 id="tags" class="heading-0-0-5"><span class="anchor-0-0-6" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Tags</h1><p>The <a href="https://connect-platform.github.io/coding-blog-plugin/tags">tags feature of Coding Blog Plugin</a> is still being developed.  Eventually the tags will link somewhere.</p><p><a class="tag-0-0-7" data-page-tag="Suggestion"><code><span class="indicator-0-0-8">#</span>Suggestion</code></a> <a class="tag-0-0-7" data-page-tag="functional_programming"><code><span class="indicator-0-0-8">#</span>functional_programming</code></a> <a class="tag-0-0-7" data-page-tag="CSharp"><code><span class="indicator-0-0-8">#</span>CSharp</code></a></p><h1 id="comments" class="heading-0-0-5"><span class="anchor-0-0-6" data-ignore-text=""><span class="icon-font" data-ignore-text="" style="vertical-align: sub">link</span></span>Comments</h1><div class="darklight-0-0-10"><div class="light"><div class="utterancesTransparentIframe-0-0-9"><script src="https://utteranc.es/client.js" data-repo="TysonMN/tyson-williams-blog" data-issue-term="pathname" data-label="💬comments" data-theme="github-light" crossorigin="anonymous" async=""></script></div></div><div class="dark"><div class="utterancesTransparentIframe-0-0-9"><script src="https://utteranc.es/client.js" data-repo="TysonMN/tyson-williams-blog" data-issue-term="pathname" data-label="💬comments" data-theme="icy-dark" crossorigin="anonymous" async=""></script></div></div></div><div class="contentnav-0-0-16" data-no-search=""><a href="#identity-extension-method" class="h1" data-content-highlight="identity-extension-method">Identity extension method</a><a href="#examples" class="h1" data-content-highlight="examples">Examples</a><a href="#1-ternary-operator" class="h2" data-content-highlight="1-ternary-operator">1. Ternary operator</a><a href="#2-explicit-interface" class="h2" data-content-highlight="2-explicit-interface">2. Explicit interface</a><a href="#3-hidden-member" class="h2" data-content-highlight="3-hidden-member">3. Hidden member</a><a href="#4-ambiguous-call" class="h2" data-content-highlight="4-ambiguous-call">4. Ambiguous call</a><a href="#5-excessive-inference" class="h2" data-content-highlight="5-excessive-inference">5. Excessive inference</a><a href="#6-type-invariance" class="h2" data-content-highlight="6-type-invariance">6. Type invariance</a><a href="#summary" class="h1" data-content-highlight="summary">Summary</a><a href="#tags" class="h1" data-content-highlight="tags">Tags</a><a href="#comments" class="h1" data-content-highlight="comments">Comments</a></div></div><div id="-codedoc-toc" class="toc-0-0-13"><div class="content-0-0-14"><p><a href="/">Home</a>
<a href="/about">About</a>
<a href="/archive">Archive</a></p><marker><hr>
Feeds

</marker><ul><li><p><a href="https://tysonwilliams.coding.blog/_feed.atom">Atom</a></p></li><li><p><a href="https://tysonwilliams.coding.blog/_feed.rss">RSS</a></p></li><li><p><a href="https://tysonwilliams.coding.blog/_feed.json">JSON</a></p></li></ul><marker><iframe src="https://github.com/sponsors/TysonMN/button" title="Sponsor TysonMN" style="height:35px;width:85%;max-width:150px;background:transparent"></iframe></marker></div></div><div class="footer-0-0-12"><div class="left"><script id="BkLbAlSLAH">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("BkLbAlSLAH", "QtYZWFHDUftjif/HGi1Mcw==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); window.setImmediate = window.setImmediate || function(f){setTimeout(f, 0)}; })()</script></div><div class="main"><div class="inside"></div></div><div class="right"><script id="WFRVkWlyWV">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("WFRVkWlyWV", "V/Du0BUwcGsy+c6jWXdl8A==", {});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); window.setImmediate = window.setImmediate || function(f){setTimeout(f, 0)}; })()</script></div></div><script id="uctkiqprdg">(function(){function load(){if (window.__sdh_transport){window.__sdh_transport("uctkiqprdg", "L6ry08rc32JxGJxF7I5qEA==", {"namespace":""});} }; if (document.readyState == 'complete') load(); else window.addEventListener('load', load); window.setImmediate = window.setImmediate || function(f){setTimeout(f, 0)}; })()</script></body></html>